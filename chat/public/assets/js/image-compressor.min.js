/*!
 * Image Compressor v0.4.0
 * https://github.com/xkeshi/image-compressor
 *
 * Copyright (c) 2017 Xkeshi
 * Released under the MIT license
 *
 * Date: 2017-08-01T07:03:56.383Z
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.ImageCompressor=t()}(this,function(){"use strict";function e(e){return a.test(e)}function t(t){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=e(t)?t.substr(6):"";return"jpeg"===r&&(r="jpg"),r&&n&&(r="."+r),r}var n=function(e,t){return t={exports:{}},e(t,t.exports),t.exports}(function(e){!function(t){var n=t.HTMLCanvasElement&&t.HTMLCanvasElement.prototype,r=t.Blob&&function(){try{return Boolean(new Blob)}catch(e){return!1}}(),i=r&&t.Uint8Array&&function(){try{return 100===new Blob([new Uint8Array(100)]).size}catch(e){return!1}}(),o=t.BlobBuilder||t.WebKitBlobBuilder||t.MozBlobBuilder||t.MSBlobBuilder,a=/^data:((.*?)(;charset=.*?)?)(;base64)?,/,l=(r||o)&&t.atob&&t.ArrayBuffer&&t.Uint8Array&&function(e){var t,n,l,u,s,c,m,h,f;if(!(t=e.match(a)))throw new Error("invalid data URI");for(n=t[2]?t[1]:"text/plain"+(t[3]||";charset=US-ASCII"),l=!!t[4],u=e.slice(t[0].length),s=l?atob(u):decodeURIComponent(u),c=new ArrayBuffer(s.length),m=new Uint8Array(c),h=0;h<s.length;h+=1)m[h]=s.charCodeAt(h);return r?new Blob([i?m:c],{type:n}):((f=new o).append(c),f.getBlob(n))};t.HTMLCanvasElement&&!n.toBlob&&(n.mozGetAsFile?n.toBlob=function(e,t,r){e(r&&n.toDataURL&&l?l(this.toDataURL(t,r)):this.mozGetAsFile("blob",t))}:n.toDataURL&&l&&(n.toBlob=function(e,t,n){e(l(this.toDataURL(t,n)))})),e.exports?e.exports=l:t.dataURLtoBlob=l}(window)}),r=Object.prototype.toString,i=function(e){return e instanceof Blob||"[object Blob]"===r.call(e)},o={maxWidth:1/0,maxHeight:1/0,minWidth:0,minHeight:0,width:void 0,height:void 0,quality:.8,mimeType:"auto",convertSize:5e6,success:null,error:null},a=/^image\/.+$/,l=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},c=window.URL||window.webkitURL,m=window.FileReader,h=/\.\w+$/;return function(){function r(e,t){l(this,r),this.result=null,e&&this.compress(e,t)}return u(r,[{key:"compress",value:function(r,a){var l=this,u=new Image;return a=s({},o,a),new Promise(function(t,n){if(i(r))if(e(r.type))if(c)t(c.createObjectURL(r));else if(m){var o=new m;o.onload=function(e){return t(e.file.result)},o.onabort=n,o.onerror=n,o.readAsDataURL(r)}else n("The current browser does not support image compression.");else n("The first argument must be an image File or Blob object.");else n("The first argument must be a File or Blob object.")}).then(function(e){return new Promise(function(t,n){u.onload=function(){t({width:u.naturalWidth,height:u.naturalHeight})},u.onabort=n,u.onerror=n,u.alt=r.name,u.src=e})}).then(function(t){var i=t.width,o=t.height;return new Promise(function(t){var l=document.createElement("canvas"),s=l.getContext("2d"),c=i/o,m=Math.max(a.maxWidth,0)||1/0,h=Math.max(a.maxHeight,0)||1/0,f=Math.max(a.minWidth,0)||0,d=Math.max(a.minHeight,0)||0,p=i,b=o;m<1/0&&h<1/0?h*c>m?h=m/c:m=h*c:m<1/0?h=m/c:h<1/0&&(m=h*c),f>0&&d>0?d*c>f?d=f/c:f=d*c:f>0?d=f/c:d>0&&(f=d*c),a.width>0?b=(p=a.width)/c:a.height>0&&(p=(b=a.height)*c),p=Math.min(Math.max(p,f),m),b=Math.min(Math.max(b,d),h),l.width=p,l.height=b,e(a.mimeType)||(a.mimeType=r.type),r.size>a.convertSize&&"image/png"===a.mimeType&&(a.mimeType="image/jpeg"),"image/jpeg"===a.mimeType&&(s.fillStyle="#fff",s.fillRect(0,0,p,b)),s.drawImage(u,0,0,p,b),l.toBlob?l.toBlob(t,a.mimeType,a.quality):t(n(l.toDataURL(a.mimeType,a.quality)))})}).then(function(e){if(c&&c.revokeObjectURL(u.src),e)if(e.size>r.size&&!(a.width>0||a.height>0||a.maxWidth<1/0||a.maxHeight<1/0||a.minWidth>0||a.minHeight>0))e=r;else{var n=new Date;e.lastModified=n.getTime(),e.lastModifiedDate=n,e.name=r.name,e.name&&e.type!==r.type&&(e.name=e.name.replace(h,t(e.type)))}else e=r;return l.result=e,a.success&&a.success(e),Promise.resolve(e)}).catch(function(e){if(!a.error)throw e;a.error(new Error(e))})}}]),r}()});